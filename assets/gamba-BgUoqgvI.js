import{j as n,R as ys,r as o}from"./vendor-mui-BPgiYWtU.js";import{S as vs,G as Vs}from"./components-CiU18N9m.js";import{T as Xs,B as Ds,I as ss,s as ls,c as Qs,O as xs,S as Zs,b as $s}from"./chance-to-cost-DlqGrH28.js";import{c as as,g as Gs,a as js,u as cs,b as Us,E as us}from"./utils-ChsWKmGh.js";function Is({upgradeArr:e,selectedUpgradeIndex:s,setUpgradeArr:r,attemptTap:E,toggleAutoAttemptThisOne:B,toggleAutoAttempt:S,freeTap:k,isAutoAttempting:l,isAutoAttemptingThisOne:u,unfinishedNormalUpgrades:c,adv_hone_strategy:H}){var f,z,N,D,C,P,p,L,K,q,Y,v,J;const w=s!==null?e[s]:null,j=(w==null?void 0:w.is_finished)??!1;return n.jsxs("div",{style:{width:300,padding:15,border:"1px solid var(--border-accent)",borderRadius:"8px",boxShadow:j?"0 0 10px var(--bright-green-glow), 0 0 20px var(--bright-green-glow)":"none"},children:[n.jsxs("h4",{style:{margin:0,marginBottom:10},children:[e[s]===void 0?"":e[s].is_normal_honing?"+":"Adv +",e[s]===void 0?"":e[s].is_normal_honing?e[s].upgrade_plus_num+1:(e[s].upgrade_plus_num+1)*10," ",e[s]===void 0?"":e[s].equipment_type]}),s!==null&&e[s]?n.jsxs(n.Fragment,{children:[e[s].is_normal_honing?n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:["Base Rate: ",(e[s].base_chance*100).toFixed(2),"%"]}),n.jsxs("div",{children:["Current Chance: ",(as(e[s])*100).toFixed(2),"%"]}),n.jsxs("div",{children:["Artisan: ",(e[s].current_artisan*100).toFixed(2),"%"]}),n.jsxs("div",{children:["Trials: ",e[s].taps_so_far]}),n.jsxs("div",{children:["Free Taps: ",e[s].free_taps_so_far]}),n.jsxs("div",{children:["In a room of 100 people, you are less lucky than ",((e[s].cumulative_chance||0)*100).toFixed(0)," of them."]})]}):(()=>{const M=Gs(e[s]);return M?n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:["Tap Count Range: ",M.range]}),n.jsx("div",{children:"In a room of 100 people, you are less lucky than "+(e[s].cumulative_chance*100).toFixed(0)+" of them."})]}):null})(),n.jsxs("div",{style:{marginTop:15,display:"flex",flexDirection:"column",gap:8},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:5},children:[n.jsx("input",{type:"checkbox",title:"This mode does not automatically use your juice, and you may go into juice debt, nobody can stop you",checked:((f=e[s])==null?void 0:f.use_juice)??!1,onChange:M=>{s!==null&&r(x=>{const b=x.slice();return b[s]={...b[s],use_juice:M.target.checked},b})}}),"Use juice"]}),n.jsxs("div",{children:[" ",!((z=e[s])!=null&&z.is_normal_honing)&&((N=e[s])==null?void 0:N.use_juice)!=(H==="Juice on grace")?"(Graph below is not updated by this tick)":""]}),n.jsx("button",{onClick:E,disabled:((D=e[s])==null?void 0:D.is_finished)||l||u,style:{padding:"5px 10px",opacity:(C=e[s])!=null&&C.is_finished?.5:1},children:(P=e[s])!=null&&P.is_finished?"Success!":"Tap"}),n.jsx("button",{onClick:B,disabled:l||((p=e[s])==null?void 0:p.is_finished)||!((L=e[s])!=null&&L.is_normal_honing),style:{padding:"5px 10px",backgroundColor:u?"var(--error-color)":"var(--btn-primary)",color:u?"white":"var(--text-primary)",border:u?"2px solid var(--error-color)":"1px solid var(--border-accent)",fontWeight:u?"bold":"normal",opacity:l||(K=e[s])!=null&&K.is_finished||!((q=e[s])!=null&&q.is_normal_honing)?.5:1},children:u?"Auto Tapping This...":"Auto Tap This One"}),n.jsx("button",{onClick:S,disabled:c.length<=1,style:{padding:"5px 10px",backgroundColor:l?"var(--error-color)":"var(--btn-primary)",color:l?"white":"var(--text-primary)",border:l?"2px solid var(--error-color)":"1px solid var(--border-accent)",fontWeight:l?"bold":"normal",opacity:c.length<=1?.5:1},children:l?"Auto Tapping...":"Auto Tap All"}),n.jsx("button",{onClick:k,disabled:((Y=e[s])==null?void 0:Y.is_normal_honing)===!1||((v=e[s])==null?void 0:v.is_finished)||l||u,style:{padding:"5px 10px",opacity:((J=e[s])==null?void 0:J.is_normal_honing)===!1?.5:1},children:"Free Tap"})]})]}):n.jsx("div",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"Select an upgrade to begin"})]})}const As=ys.memo(function({upgrade:s,children:r,tooltipHandlers:E}){const B=["Red","Blue","Leaps","Shards","Oreha","Gold","Silver","Red Juice","Blue Juice","Special Leaps"],S=ys.useMemo(()=>{const c=new Array(10).fill(0),H=s.taps_so_far??0,w=s.juice_taps_so_far??0,j=s.free_taps_so_far??0;for(let f=0;f<7;f++)c[f]=s.costs[f]*H;if(w>0){const f=s.one_juice_cost*w;s.is_weapon?c[8]=f:c[7]=f}return c[9]=s.special_cost*j,c},[s.taps_so_far,s.juice_taps_so_far,s.free_taps_so_far,s.costs,s.one_juice_cost,s.special_cost,s.is_weapon]),k=c=>{E.showUpgradeTooltip(s,B,S,c.clientX,c.clientY)},l=c=>{E.updateTooltipPosition(c.clientX,c.clientY)},u=()=>{E.hideTooltip()};return n.jsx("div",{onMouseEnter:k,onMouseMove:l,onMouseLeave:u,children:r})});function sn({upgradeArr:e,sortedWithIndex:s,selectedUpgradeIndex:r,handleUpgradeSelection:E,isAutoAttempting:B,isAutoAttemptingThisOne:S,tooltipHandlers:k}){return n.jsxs("div",{style:{width:170},children:[n.jsx("style",{children:`
                    .upgrade-scroll-container::-webkit-scrollbar {
                        width: 6px;
                    }
                    .upgrade-scroll-container::-webkit-scrollbar-track {
                        background: var(--background-secondary);
                        border-radius: 3px;
                    }
                    .upgrade-scroll-container::-webkit-scrollbar-thumb {
                        background: var(--border-accent);
                        border-radius: 3px;
                    }
                    .upgrade-scroll-container::-webkit-scrollbar-thumb:hover {
                        background: var(--accent-color);
                    }
                `}),n.jsxs("h4",{style:{margin:0,fontSize:"var(--font-size-sm)",marginBottom:10},children:["Upgrades: ",(B||S)&&n.jsx("span",{style:{color:"var(--error-color)",fontSize:"var(--font-size-xs)"},children:"AUTO ON"})]}),n.jsx("div",{className:"upgrade-scroll-container",style:{display:"flex",flexDirection:"column",gap:2,width:170,maxHeight:"800px",overflowY:"auto",paddingRight:"4px"},children:s.map(l=>{const u=e[l];return n.jsx(As,{upgrade:u,tooltipHandlers:k,children:n.jsxs("div",{onClick:()=>E(l),style:{padding:"8px",border:r===l?"2px solid var(--selected-blue)":"1px solid var(--border-accent)",borderRadius:"4px",cursor:"pointer",backgroundColor:"transparent",fontSize:"var(--font-size-sm)",position:"relative",animation:(B||S)&&r===l?"pulse 1s infinite":"none",color:u.is_finished?"var(--btn-success)":"var(--text-primary)"},children:[u.is_normal_honing?"+":"Adv +",u.is_normal_honing?u.upgrade_plus_num+1:(u.upgrade_plus_num+1)*10," ",u.equipment_type,u.is_normal_honing&&n.jsxs("span",{style:{marginLeft:"4px",fontSize:"var(--font-size-xs)"},children:[((u.current_artisan??0)*100).toFixed(0),"% Artisan"]})]})},l)})})]})}function nn({upgradeArr:e,setUpgradeArr:s,selectedUpgradeIndex:r,setSelectedUpgradeIndex:E,finalCosts:B,setFinalCosts:S,completionCounter:k,setCompletionCounter:l,isAutoAttempting:u,setIsAutoAttempting:c,isAutoAttemptingThisOne:H,setIsAutoAttemptingThisOne:w,unfinishedNormalUpgrades:j,flushUpgradeArrToState:f}){const z=o.useRef(e),N=o.useRef(r),D=o.useRef(B),C=o.useRef(u),P=o.useRef(H),p=o.useRef(null);z.current=e,N.current=r,D.current=B,C.current=u,P.current=H;const L=o.useCallback(()=>{const x=N.current,b=z.current;if(x===null||!b||!b[x]){p.current!=null&&(clearTimeout(p.current),p.current=null,c(!1),C.current=!1,w(!1),P.current=!1);return}const t=b[x];if(t.is_finished)return;const _=()=>{let T=!1,O=-1;if(t.is_normal_honing){const F=as(t);T=Math.random()<F}else{let F=t.prob_dist;t.use_juice&&t.other_prob_dist&&(F=t.other_prob_dist);const d=Math.random();let V=0,Q=0;for(let a=0;a<F.length;a++)if(V+=F[a],d<=V){Q=a;break}t.cumulative_chance=V,O=t.tap_offset+Q,T=!0,t.taps_so_far=O-1}if(S(F=>{var V,Q;const d=F.slice();if(t.is_normal_honing){for(let a=0;a<7;a++)d[a]=(d[a]??0)+(((V=t.costs)==null?void 0:V[a])??0);if(t.use_juice){const a=t.one_juice_cost??0;t.is_weapon?d[7]=(d[7]??0)+a:d[8]=(d[8]??0)+a}}else{for(let a=0;a<7;a++)d[a]=(d[a]??0)+((Q=t.costs)==null?void 0:Q[a])*O;if(t.use_juice){const a=t.adv_juice_cost[O-t.tap_offset]??0;t.is_weapon?d[7]=(d[7]??0)+a:d[8]=(d[8]??0)+a}}return D.current=d,d}),t.taps_so_far=(t.taps_so_far||0)+1,t.juice_taps_so_far=(t.juice_taps_so_far||0)+(t.use_juice?1:0),t.is_normal_honing){const F=as(t);cs(t,F),T||(t.current_artisan=Math.min(1,(t.current_artisan||0)+46.51/100*F*(t.artisan_rate??0)))}return{success:T,advTapCount:O}};let R=!1;if(C.current&&!P.current)do R=_().success;while(!R);else R=_().success;if(R){if(t.is_finished=!0,t.completion_order=(t.completion_order||0)+1,l(T=>T+1),P.current)p.current!=null&&(clearTimeout(p.current),p.current=null),w(!1),P.current=!1,c(!1),C.current=!1;else if(C.current){const T=js(z.current,x);T!==-1?(E(T),N.current=T):(p.current!=null&&(clearTimeout(p.current),p.current=null),c(!1),C.current=!1)}}z.current[x]=t,f(!!R)},[f,S,l,E,c,w]),K=o.useCallback(()=>L(),[L]),q=o.useCallback(x=>{if(p.current!=null)return;C.current=!0,c(!0);const b=()=>{L(),C.current?p.current=window.setTimeout(b,Math.max(5,x)):p.current=null};b()},[L,c]),Y=o.useCallback(()=>{p.current!=null&&(clearTimeout(p.current),p.current=null),c(!1),C.current=!1,w(!1),P.current=!1},[c,w]),v=o.useCallback(()=>{if(C.current)Y();else if(j.length>0){if(!r||!e[r]||e[r].is_finished){const x=js(z.current,r);E(x),N.current=x}q(0)}},[q,Y,j,N,E,e,r]),J=o.useCallback(()=>{P.current?Y():r!==null&&e[r]&&!e[r].is_finished&&(w(!0),P.current=!0,q(10))},[q,Y,r,e,w]),M=o.useCallback(()=>{if(r===null||!e[r])return;const x=e[r],b=Math.random()<x.base_chance;S(t=>{const _=t.slice();return _[9]=(_[9]||0)+x.special_cost,_}),b?(s(t=>{const _=t.slice(),R={..._[r],is_finished:!0,completion_order:k+1,free_taps_so_far:(_[r].free_taps_so_far??0)+1};return R.is_normal_honing&&cs(R,R.base_chance),_[r]=R,_}),l(t=>t+1)):s(t=>{const _=t.slice(),R={..._[r],free_taps_so_far:(_[r].free_taps_so_far??0)+1};return R.is_normal_honing&&cs(R,R.base_chance),_[r]=R,_})},[r,e,S,s,k,l]);return{attemptTap:K,toggleAutoAttempt:v,toggleAutoAttemptThisOne:J,freeTap:M}}function cn({budget_inputs:e,set_budget_inputs:s,userMatsValue:r,setUserMatsValue:E,topGrid:B,bottomGrid:S,adv_hone_strategy:k,express_event:l,bucketCount:u,autoOptimization:c,dataSize:H,tooltipHandlers:w,chance_result:j,cachedChanceGraphData:f,AnythingTicked:z,CostToChanceBusy:N,cumulativeGraph:D,lockXAxis:C,lockedMins:P,lockedMaxs:p,useGridInput:L,normalCounts:K,advCounts:q}){const{costToChanceColumnDefs:Y}=Qs(!0),[v,J]=o.useState([]),[M,x]=o.useState(0),[b,t]=o.useState(new Array(10).fill(0)),[_,R]=o.useState(new Array(2).fill(0)),[T,O]=o.useState(!1),[F,d]=o.useState(!1),[V,Q]=o.useState(0),[a,ds]=o.useState(!1),$=o.useRef(null),X=o.useRef(null),ns=o.useRef(new Map),A=o.useRef(null),fs=o.useRef([]),Rs=o.useRef(null),ws=o.useRef(M),os=o.useRef(v),Ts=o.useRef(b),_s=o.useRef(_),G=o.useRef(null),Ss=o.useCallback((i=!1)=>{if(i){G.current&&(clearTimeout(G.current),G.current=null),J(m=>os.current.slice());return}G.current==null&&(G.current=window.setTimeout(()=>{J(m=>os.current.slice()),G.current=null},100))},[]);o.useEffect(()=>{ws.current=M},[M]),o.useEffect(()=>{os.current=v},[v]),o.useEffect(()=>{Ts.current=b},[b]),o.useEffect(()=>{_s.current=_},[_]),o.useEffect(()=>($.current=new Worker(new URL("/Honing-Forecast/assets/js_to_wasm-qmTMyx06.js",import.meta.url),{type:"module"}),$.current.onmessage=i=>{const{id:m,type:g,result:y}=i.data;g==="result"&&ns.current.has(m)&&(ns.current.get(m)(y),ns.current.delete(m))},()=>{$.current&&$.current.terminate(),A.current&&clearTimeout(A.current)}),[]);const ms=o.useCallback(async()=>{if(!$.current)return;const i=Us({topGrid:B,bottomGrid:S,budget_inputs:e,adv_hone_strategy:k,express_event:l,bucketCount:u,autoOptimization:c,userMatsValue:r,dataSize:H,useGridInput:L,normalCounts:K,advCounts:q}),m=Math.random().toString(36).substr(2,9),g=new Promise(y=>ns.current.set(m,y));$.current.postMessage({id:m,payload:i,which_one:"ParserUnified"}),g.then(y=>{const W=y.upgrades,U=y.unlocks,ps=y.other_strategy_prob_dists;R(U),_s.current=U;let ts=Array.from({length:Xs},()=>0),rs=Array.from({length:Ds},()=>0),es=W.map(h=>{if(h.is_weapon)return{...h,equipment_type:"Weapon"};{const Os=us.slice(0,5).find((en,I)=>{if(h.is_normal_honing){if(I<ts[h.upgrade_plus_num])return!1;if(L){const Z=B[I]||[];return ts[h.upgrade_plus_num]+=1,Z[h.upgrade_plus_num]||!1}else{const Z=K[0][h.upgrade_plus_num]||0;return ts[h.upgrade_plus_num]+=1,I<Z}}else{if(I<rs[h.upgrade_plus_num])return!1;if(L){const Z=S[I]||[];return rs[h.upgrade_plus_num]+=1,Z[h.upgrade_plus_num]||!1}else{const Z=q[0][h.upgrade_plus_num]||0;return rs[h.upgrade_plus_num]+=1,I<Z}}});return{...h,equipment_type:Os||"Armor"}}});es.sort((h,bs)=>h.is_normal_honing?-999:h.upgrade_plus_num-bs.upgrade_plus_num);let is=0;es.forEach(h=>{!h.is_normal_honing&&is<ps.length&&(h.other_prob_dist=ps[is],is++)}),J(es.map(h=>({...h,is_finished:!1,completion_order:0,current_artisan:0,taps_so_far:0,juice_taps_so_far:0,free_taps_so_far:0,use_juice:k==="Juice on grace"&&!h.is_normal_honing,cumulative_chance:0}))),fs.current=es})},[B,S,k,l,u,c,r,H,e,L,K,q]),ks=o.useMemo(()=>String(k),[k]),Cs=o.useMemo(()=>String(l),[l]),Ms=o.useMemo(()=>String(L),[L]),gs=o.useMemo(()=>JSON.stringify(K),[K]),Es=o.useMemo(()=>JSON.stringify(q),[q]),Ls=o.useMemo(()=>a,[a]);o.useEffect(()=>(X.current&&(window.clearTimeout(X.current),X.current=null),t(new Array(10).fill(0)),x(null),A.current&&(clearTimeout(A.current),A.current=null),O(!1),X.current=window.setTimeout(()=>{ms(),X.current=null},100),()=>{X.current&&(window.clearTimeout(X.current),X.current=null)}),[ks,Cs,Ls,ms,Ms,gs,Es]),o.useEffect(()=>{fs.current=v},[v]),o.useEffect(()=>{Rs.current=M},[M]);const Fs=o.useMemo(()=>{const i=v.map((m,g)=>g);return i.sort((m,g)=>{const y=v[m],W=v[g];return y.is_finished<W.is_finished?-1:y.is_finished>W.is_finished||y.is_normal_honing<W.is_normal_honing?1:y.is_normal_honing>W.is_normal_honing?-1:y.is_finished&&W.is_finished?(y.completion_order||0)-(W.completion_order||0):!y.is_finished&&!W.is_finished?y.upgrade_plus_num<W.upgrade_plus_num?-1:y.upgrade_plus_num>W.upgrade_plus_num?1:us.findIndex(U=>y.equipment_type==U)-us.findIndex(U=>W.equipment_type==U):0}),i},[v]),hs=o.useMemo(()=>v.filter(i=>!i.is_finished),[v]),{attemptTap:Bs,toggleAutoAttempt:Ps,toggleAutoAttemptThisOne:qs,freeTap:Ws}=nn({upgradeArr:v,setUpgradeArr:J,selectedUpgradeIndex:M,setSelectedUpgradeIndex:x,finalCosts:b,setFinalCosts:t,completionCounter:V,setCompletionCounter:Q,isAutoAttempting:T,setIsAutoAttempting:O,isAutoAttemptingThisOne:F,setIsAutoAttemptingThisOne:d,unfinishedNormalUpgrades:hs,flushUpgradeArrToState:Ss}),zs=o.useCallback(i=>{x(i)},[]),Ns=o.useCallback(()=>{ds(i=>!i)},[]),Ks=ss.map((i,m)=>{const g=parseInt(e[i]||"0"),y=b[m]||0;return g-y}),Js=ss.reduce((i,m,g)=>(i[m]=(b[g]+(g===3?_[0]:g===6?_[1]:0)).toFixed(0).toString(),i),{}),Hs=ss.reduce((i,m,g)=>(i[m]=Ks[g].toFixed(0).toString(),i),{}),Ys=[{headerName:"Total Cost",field:"total",editable:!1,flex:1,cellStyle:{backgroundColor:"var(--background-secondary)",color:"var(--text-primary)"}},{headerName:"Remaining",field:"remaining",editable:!1,flex:1,cellStyle:i=>{const m=parseInt(i.value||"0");return{backgroundColor:m<0?"var(--ran-out)":"transparent",color:m<0?"white":"var(--text-primary)"}}}];return n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
                    @keyframes pulse {
                        0% { opacity: 1; }
                        50% { opacity: 0.7; }
                        100% { opacity: 1; }
                    }
                `}),n.jsx("div",{style:{...ls.inputSection,flexDirection:"row",maxWidth:"1200px",width:"100%"},children:n.jsxs("div",{style:{display:"flex",gap:20,alignItems:"flex-start"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0,alignItems:"flex-start",justifyContent:"start",width:c?210:300},children:[n.jsx("div",{style:{width:210},children:n.jsx(vs,{columnDefs:Y,labels:ss,sheet_values:e,set_sheet_values:s,secondaryValues:r,setSecondaryValues:E})}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[n.jsx("div",{style:{...ls.inputLabelCell,whiteSpace:"nowrap",backgroundColor:"var(--bg-tertiary)"},children:"Chance of Success"}),n.jsx("div",{style:{...ls.inputCell,border:"none",background:"transparent",color:"var(--text-success)",fontSize:"var(--font-size-xl)"},children:j?String(j.chance)+"%":"-"})]}),n.jsx("button",{onClick:Ns,style:{padding:"8px 16px",backgroundColor:"var(--btn-primary)",color:"var(--text-primary)",border:"1px solid var(--border-accent)",borderRadius:"4px",cursor:"pointer",fontSize:"var(--font-size-sm)",fontWeight:"var(--font-weight-bold)"},children:"Restart gamba"})]}),n.jsx(sn,{upgradeArr:v,sortedWithIndex:Fs,selectedUpgradeIndex:M,handleUpgradeSelection:zs,isAutoAttempting:T,isAutoAttemptingThisOne:F,tooltipHandlers:w}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0},children:[n.jsxs("div",{style:{display:"flex",gap:20},children:[n.jsx(Is,{upgradeArr:v,selectedUpgradeIndex:M,setUpgradeArr:J,attemptTap:Bs,toggleAutoAttemptThisOne:qs,toggleAutoAttempt:Ps,freeTap:Ws,isAutoAttempting:T,isAutoAttemptingThisOne:F,unfinishedNormalUpgrades:hs,adv_hone_strategy:k}),n.jsx("div",{style:{width:200,marginLeft:70},children:n.jsx(vs,{columnDefs:Ys,labels:ss,sheet_values:Js,set_sheet_values:()=>{},secondaryValues:Hs,setSecondaryValues:()=>{},readOnly:!0})})]}),n.jsx("div",{style:{marginTop:20,display:"flex",gap:20},children:n.jsx("div",{style:{flex:1},children:n.jsx(Vs,{title:"Budget vs Total Cost Distribution",labels:xs,counts:z?(j==null?void 0:j.hist_counts)||(f==null?void 0:f.hist_counts):null,mins:(j==null?void 0:j.hist_mins)||(f==null?void 0:f.hist_mins),maxs:(j==null?void 0:j.hist_maxs)||(f==null?void 0:f.hist_maxs),width:$s,height:Zs,budgets:xs.map(i=>Number(e[i]||0)),additionalBudgets:b.slice(0,7).map((i,m)=>i+(m===3?_[0]:m===6?_[1]:0)),hasSelection:z,isLoading:N,cumulative:D,lockXAxis:C,lockedMins:P,lockedMaxs:p})})})]})]})})]})}export{cn as G};
//# sourceMappingURL=gamba-BgUoqgvI.js.map
