import{g as $,d as Y,T as N,f as X,B as O,I as L}from"./chance-to-cost-DKk9rqNy.js";import{S as E}from"./wasm-workers-CSWhRIRv.js";import{r as z,j as m}from"./vendor-mui-BPgiYWtU.js";function Z(t,o,i,r,c,n,l,a,u,h,f,p,d,b,_){const y={topGrid:t,bottomGrid:o,adv_hone_strategy:i,express_event:r,prev_checked_arr:c,prev_checked_arr_bottom:n,desired_chance:l,budget_inputs:a,autoOptimization:u,userMatsValue:h,cumulativeGraph:f,dataSize:p,useGridInput:d,normalCounts:b,advCounts:_};localStorage.setItem($,JSON.stringify(y))}function R(t,o,i,r,c,n,l,a,u,h,f,p,d,b,_){var g,s,x,v;const y=localStorage.getItem($);if(!y)return;const e=JSON.parse(y);e&&typeof e=="object"&&(Array.isArray(e.topGrid)&&e.topGrid.length===Y&&((g=e.topGrid[0])==null?void 0:g.length)===N&&t(e.topGrid),Array.isArray(e.bottomGrid)&&e.bottomGrid.length===X&&((s=e.bottomGrid[0])==null?void 0:s.length)===O&&o(e.bottomGrid),typeof e.adv_hone_strategy=="string"&&i(e.adv_hone_strategy),typeof e.express_event=="boolean"&&r(e.express_event),Array.isArray(e.prev_checked_arr)&&e.prev_checked_arr.length===N&&c(e.prev_checked_arr),Array.isArray(e.prev_checked_arr_bottom)&&e.prev_checked_arr_bottom.length===O&&n(e.prev_checked_arr_bottom),typeof e.desired_chance=="string"&&l(e.desired_chance),e.budget_inputs&&typeof e.budget_inputs=="object"&&a(e.budget_inputs),typeof e.autoOptimization=="boolean"&&u(e.autoOptimization),e.userMatsValue&&typeof e.userMatsValue=="object"&&h(e.userMatsValue),typeof e.cumulativeGraph=="boolean"&&f(e.cumulativeGraph),typeof e.dataSize=="string"&&p(e.dataSize),typeof e.useGridInput=="boolean"&&d(e.useGridInput),Array.isArray(e.normalCounts)&&e.normalCounts.length===2&&((x=e.normalCounts[0])==null?void 0:x.length)===N&&b(e.normalCounts),Array.isArray(e.advCounts)&&e.advCounts.length===2&&((v=e.advCounts[0])==null?void 0:v.length)===O&&_(e.advCounts))}function J(t,o,i){const r=t.length;if(r===0)return[];if(!isFinite(o)||o<=0)return t.slice();if(!isFinite(i)||i<=0)return new Array(r).fill(0);const c=o/r,n=i/r;if(i===o)return t.slice();const l=new Array(r).fill(0);for(let a=0;a<r;a++){const u=t[a]??0;if(u===0)continue;const h=a*c,f=(a+1)*c;if(h>=i)continue;const p=Math.floor(h/n),d=Math.floor((Math.min(f,i)-1e-12)/n),b=Math.max(0,p),_=Math.min(r-1,d);if(_<b){const y=Math.floor(h/n),e=Math.min(Math.max(0,y),r-1),g=e*n,s=(e+1)*n,x=Math.max(h,g),v=Math.min(f,s,i),w=Math.max(0,v-x);w>0&&(l[e]+=u*(w/c));continue}for(let y=b;y<=_;y++){const e=y*n,g=(y+1)*n,s=Math.max(h,e),x=Math.min(f,g,i),v=Math.max(0,x-s);if(v<=0)continue;const w=v/c;l[y]+=u*w}}return l}function W(t,o,i){if(!t||!i)return t;const r=t.length,c=Array.from({length:r},()=>[]);for(let n=0;n<r;n++){const l=t[n]||[],a=o&&typeof o[n]=="number"?o[n]:1,u=typeof i[n]=="number"?i[n]:a;c[n]=J(l,a,u)}return c}const B=["Helmet","Shoulder","Chest","Pants","Gloves","Weapon"];function U(t){let o=[...t];return o.sort((i,r)=>i.is_finished<r.is_finished?-1:i.is_finished>r.is_finished||i.is_normal_honing<r.is_normal_honing?1:i.is_normal_honing>r.is_normal_honing?-1:i.is_finished&&r.is_finished?(i.completion_order||0)-(r.completion_order||0):!i.is_finished&&!r.is_finished?i.upgrade_plus_num<r.upgrade_plus_num?-1:i.upgrade_plus_num>r.upgrade_plus_num?1:B.findIndex((c,n)=>i.equipment_type==c)-B.findIndex((c,n)=>r.equipment_type==c):0),o}function tt(t,o){let i=t.findIndex(r=>r==U(t).find((c,n)=>!c.is_finished&&n>o));return console.log(i),i<0?t.findIndex(r=>r==U(t).find((c,n)=>!c.is_finished&&n!==o)):i}function nt(t){if(!t.is_normal_honing)return 0;const o=t.base_chance,i=Math.min(t.taps_so_far,10),r=o+o/10*i;return Math.max(0,Math.min(1,t.current_artisan>=1?1:t.use_juice?r+t.base_chance:r))}function et(t,o){if(!t.is_normal_honing)return;t.cumulative_chance===void 0&&(t.cumulative_chance=0);const i=1-t.cumulative_chance;t.cumulative_chance+=o*i,t.cumulative_chance=Math.min(1,t.cumulative_chance)}function rt(t){if(t.is_normal_honing)return null;const o=t.use_juice&&t.other_prob_dist?t.other_prob_dist:t.prob_dist,i=`${t.tap_offset} - ${t.tap_offset+o.length}`,r=t.use_juice&&t.other_prob_dist;return{range:i,isUsingOtherStrategy:r}}function F(t){if(t.length===0||t[0].length===0)return[[],[]];const o=t[0].length,i=[[],[]];for(let r=0;r<o;r++){let c=0;for(let n=0;n<5;n++)t[n]&&t[n][r]&&c++;i[0][r]=c,i[1][r]=t[5]&&t[5][r]?1:0}return i}function it(t){if(t.length<2||t[0].length===0)return Array.from({length:6},()=>[]);const o=t[0].length,i=Array.from({length:6},()=>Array(o).fill(!1));for(let r=0;r<o;r++){const c=Math.min(5,Math.max(0,t[0][r]||0)),n=Math.min(1,Math.max(0,t[1][r]||0));for(let l=0;l<c;l++)i[l][r]=!0;n>0&&(i[5][r]=!0)}return i}function ot({topGrid:t,bottomGrid:o,budget_inputs:i,adv_hone_strategy:r,express_event:c,bucketCount:n,autoOptimization:l,userMatsValue:a,dataSize:u,useGridInput:h=!0,normalCounts:f,advCounts:p}){const d={budget:(b=>Object.entries(b).map(([,_])=>Math.round(Number(_))))(i),adv_hone_strategy:r,express_event:c,bucket_count:Math.max(2,Math.min(1e3,Math.floor(Number(n)||2))),user_mats_value:l?L.slice(0,7).map(b=>0):L.slice(0,7).map(b=>parseFloat(a[b]||"0")),data_size:Math.max(1e3,Math.floor(Number(u)||0))};return h?(d.normal_hone_ticks=t,d.adv_hone_ticks=o):(d.normal_counts=f||F(t),d.adv_counts=p||F(o)),d}function st({costWorkerRef:t,chanceWorkerRef:o,averageCostWorkerRef:i,parserWorkerRef:r,setCostToChanceBusy:c,setChanceToCostBusy:n,setAverageCostBusy:l,setParserBusy:a,set_chance_result:u,set_cost_result:h,setAverageCosts:f,setUpgradeArr:p,setCachedChanceGraphData:d,setCachedCostGraphData:b}){return(_,y)=>{if(_==="CostToChance"){if(t.current){try{t.current.terminate()}catch{}t.current=null}c(!0),u(null);const{worker:e,promise:g}=E(y,_);t.current=e,g.then(s=>{if(t.current===e&&(u(s),s&&typeof s=="object"&&s!==null&&"hist_counts"in s)){const x=s;d({hist_counts:x.hist_counts,hist_mins:x.hist_mins,hist_maxs:x.hist_maxs})}}).catch(s=>{console.error("Worker error",s),t.current===e&&u({error:String(s)})}).finally(()=>{if(t.current===e){try{e.terminate()}catch{}t.current=null,c(!1)}})}else if(_==="ChanceToCost"){if(o.current){try{o.current.terminate()}catch{}o.current=null}n(!0),h(null);const{worker:e,promise:g}=E(y,_);o.current=e,g.then(s=>{if(o.current===e&&(h(s),s&&typeof s=="object"&&s!==null&&"hist_counts"in s)){const x=s;b({hist_counts:x.hist_counts,hist_mins:x.hist_mins,hist_maxs:x.hist_maxs})}}).catch(s=>{console.error("Worker error",s),o.current===e&&h({error:String(s)})}).finally(()=>{if(o.current===e){try{e.terminate()}catch{}o.current=null,n(!1)}})}else if(_==="AverageCost"){if(i.current){try{i.current.terminate()}catch{}i.current=null}l(!0),f(null);const{worker:e,promise:g}=E(y,_);i.current=e,g.then(s=>{i.current===e&&s&&s.average_costs&&f(s.average_costs)}).catch(s=>{console.error("AverageCost worker error",s),i.current===e&&f(null)}).finally(()=>{if(i.current===e){try{e.terminate()}catch{}i.current=null,l(!1)}})}else if(_==="ParserUnified"){if(r.current){try{r.current.terminate()}catch{}r.current=null}a(!0),p([]);const{worker:e,promise:g}=E(y,_);r.current=e,g.then(s=>{r.current===e&&s&&s.upgrades&&p(s.upgrades)}).catch(s=>{console.error("Parser worker error",s),r.current===e&&p([])}).finally(()=>{if(r.current===e){try{e.terminate()}catch{}r.current=null,a(!1)}})}}}function at({activePage:t,onPageChange:o}){const[i,r]=z.useState(t);z.useEffect(()=>{r(t)},[t]);const c=a=>{o(a),r(a)},n=()=>t==="chance-to-cost"?"hf-separator chance-active":t==="cost-to-chance"?"hf-separator budget-active":t==="gamba"?"hf-separator gamba-active":"hf-separator",l=a=>{const u="hf-btn";if(t===a){if(a==="chance-to-cost")return`${u} chance-selected`;if(a==="cost-to-chance")return`${u} budget-selected`;if(a==="gamba")return`${u} gamba-selected`}return u};return m.jsxs("div",{className:n(),children:[m.jsxs("button",{className:l("chance-to-cost"),onClick:()=>c("chance-to-cost"),children:[m.jsx("span",{className:"hf-label",children:"Chance mode"}),m.jsx("div",{className:"hf-help",children:"I want to have x% chance to pass, how much mats will I need?"})]}),m.jsxs("button",{className:l("cost-to-chance"),onClick:()=>c("cost-to-chance"),children:[m.jsx("span",{className:"hf-label",children:"Budget mode"}),m.jsx("div",{className:"hf-help",children:"I have this much mats, what are my odds of success?"})]}),m.jsxs("button",{className:l("gamba"),onClick:()=>c("gamba"),children:[m.jsx("span",{className:"hf-label",children:"Gamba simulator"}),m.jsx("div",{className:"hf-help",children:"Simulate a honing session without hurting your wallet or your soul"})]})]})}function ct(t){return{showSeparatorTooltip:(n,l,a)=>{t({visible:!0,type:"separator",x:l+10,y:a-10,content:n,upgradeData:null})},showUpgradeTooltip:(n,l,a,u,h)=>{t({visible:!0,type:"upgrade",x:u+10,y:h,content:null,upgradeData:{upgrade:n,costLabels:l,tapRecordCosts:a}})},hideTooltip:()=>{t(n=>({...n,visible:!1}))},updateTooltipPosition:(n,l)=>{t(a=>({...a,x:n+10,y:l-10}))}}}function lt(t,o=1,i=1){if(!t.visible)return null;const r=o*i,c={position:"fixed",left:t.x,top:t.y,backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",padding:t.type==="upgrade"?"12px 16px":"8px 12px",borderRadius:"var(--border-radius-small)",fontSize:"var(--font-size-sm)",fontWeight:"var(--font-weight-normal)",border:"1px solid var(--border-secondary)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e4,pointerEvents:"none",opacity:t.visible?1:0,transition:"opacity 0.1s ease-in-out",minWidth:t.type==="upgrade"?"300px":"auto",maxWidth:t.type==="upgrade"?"400px":"auto",whiteSpace:t.type==="separator"?"nowrap":"normal",transform:`scale(${r})`,transformOrigin:"top left"};if(t.type==="separator")return m.jsx("div",{style:c,children:t.content});if(t.type==="upgrade"&&t.upgradeData){const{upgrade:n,costLabels:l,tapRecordCosts:a}=t.upgradeData,u={display:"flex",flexDirection:"column",gap:"4px",marginRight:"16px",width:"35%",minWidth:"120px"},h={display:"flex",flexDirection:"column",gap:"2px",width:"65%",minWidth:"180px"},f={display:"flex",flexDirection:"row"};return m.jsx("div",{style:c,children:m.jsxs("div",{style:f,children:[m.jsxs("div",{style:u,children:[m.jsx("div",{children:m.jsxs("strong",{children:[n.is_normal_honing?"+":"Adv +",n.upgrade_plus_num+(n.is_normal_honing?1:0)," ",n.equipment_type]})}),n.is_finished&&n.current_artisan&&m.jsxs("div",{children:["Artisan: ",(n.current_artisan*100).toFixed(2),"%"]}),m.jsxs("div",{children:["Taps: ",n.taps_so_far??0]}),m.jsxs("div",{children:["Juice Taps: ",n.juice_taps_so_far??0]}),m.jsxs("div",{children:["Free Taps: ",n.free_taps_so_far??0]}),n.is_normal_honing&&n.is_finished&&m.jsxs("div",{children:["In a room of 100 people, you are less lucky than ",((n.cumulative_chance||0)*100).toFixed(0)," of them."]})]}),m.jsxs("div",{style:h,children:[m.jsx("div",{children:m.jsx("strong",{children:"Costs so far(excluding unlock):"})}),l.map((p,d)=>m.jsxs("div",{children:[p,": ",a[d].toLocaleString()]},d))]})]})})}return null}function G(t,o,i,r,c){if(!t)return{r:0,c:0};const n=t.getBoundingClientRect(),l=Math.max(0,Math.min(o-n.left,n.width-1)),a=Math.max(0,Math.min(i-n.top,n.height-1));let u=n.width/c,h=n.height/r;const f=Math.floor(l/u),p=Math.floor(a/h);return{r:Math.max(0,Math.min(r-1,p)),c:Math.max(0,Math.min(c-1,f))}}function ut({topGridRef:t,bottomGridRef:o,marqueeRef:i,topGrid:r,bottomGrid:c,setMarquee:n}){return(l,a)=>{a.preventDefault();const u=l==="top"?t.current:o.current,h=l==="top"?Y:X,f=l==="top"?N:O,{r:p,c:d}=G(u,a.clientX,a.clientY,h,f),b=l==="top"?r[p][d]:c[p][d],_={active:!0,grid:l,startR:p,startC:d,endR:p,endC:d,startClientX:a.clientX,startClientY:a.clientY,endClientX:a.clientX,endClientY:a.clientY,initialState:b};n(_),i.current=_}}function ht(t,o,i,r,c){const n=o.current;if(!n||!n.active||!n.grid)return;const l=n.grid,a=l==="top"?i.current:r.current,u=l==="top"?Y:X,h=l==="top"?N:O,{r:f,c:p}=G(a,t.clientX,t.clientY,u,h);c(d=>({...d,endR:f,endC:p,endClientX:t.clientX,endClientY:t.clientY}))}function ft({marqueeRef:t,topGridRef:o,bottomGridRef:i,setTopGrid:r,setBottomGrid:c,set_prev_checked_arr:n,set_prev_checked_arr_bottom:l,setMarquee:a}){return u=>{const h=t.current;if(!h||!h.active||!h.grid)return;const{grid:f,startClientX:p,startClientY:d,endClientX:b,endClientY:_,initialState:y}=h,e=f==="top"?o.current:i.current,g=f==="top"?Y:X,s=f==="top"?N:O,x=G(e,p,d,g,s),v=G(e,b||u.clientX,_||u.clientY,g,s),w=Math.min(x.r,v.r),P=Math.max(x.r,v.r),A=Math.min(x.c,v.c),D=Math.max(x.c,v.c);(f==="top"?r:c)(H=>{const T=H.map(C=>C.slice()),q=!y;for(let C=w;C<=P;C++)for(let S=A;S<=D;S++)C<T.length&&S<T[C].length&&(T[C][S]=q);return f==="top"?n(C=>{const S=[...C];for(let j=A;j<=D;j++){let I=!0;for(let M=0;M<g;M++)if(!T[M][j]){I=!1;break}S[j]=I}return S}):l(C=>{const S=[...C];for(let j=A;j<=D;j++){let I=!0;for(let M=0;M<g;M++)if(!T[M][j]){I=!1;break}S[j]=I}return S}),T}),a({active:!1,grid:null,startR:0,startC:0,endR:0,endC:0,startClientX:0,startClientY:0,endClientX:0,endClientY:0,initialState:!1})}}export{B as E,ut as G,at as S,tt as a,ot as b,nt as c,R as d,ft as e,st as f,rt as g,lt as h,ct as i,it as j,ht as m,W as r,F as t,et as u,Z as w};
//# sourceMappingURL=utils-BdNnqXCI.js.map
