(function(){"use strict";function D(e){let a=Array.from({length:2},()=>new Array(e[0].length).fill(0));for(let s=0;s<e[0].length;s++)a[0][s]=(e[0][s]?1:0)+(e[1][s]?1:0)+(e[2][s]?1:0)+(e[3][s]?1:0)+(e[4][s]?1:0),a[1][s]=e[5][s]?1:0;return a}function k(e){if(!e)throw"Assertion failed"}function W(e,a,s,r=1){if(!Array.isArray(e)||!Array.isArray(a))throw new Error("Both inputs must be arrays");for(var t=Math.min(e.length,a.length),n=t;n--;)e[n]=Number(e[n])+Number(a[n][s])*r;return e}function q(e,a){var s;let r=a.map((n=>l=>n+=l)(0));var t=Math.random();return s=r.findIndex(n=>t<=n),e[s]}function Z(e){e*=100;let a=0;for(;;){if(e>=1/10**a)return e.toFixed(a);if(a>=4)return"0";a++}}function H(e,a){var s=e.length,r=a.length,t=s>0?e[0].length:0;return s===0||r===0||t===0?new Array(r).fill(0):r>=3*s?ee(e,a):$(e,a)}function $(e,a){for(var s=e.length,r=a.length,t=new Array(r),n=0;n<r;n++)t[n]=0;for(var l=0;l<s;l++)for(var i=e[l],m=i[0],f=i[1],_=i[2],v=i[3],w=i[4],A=i[5],y=i[6],M=0;M<r;M++){var o=a[M],h=o[0],p=o[1],c=o[2],u=o[3],N=o[4],S=o[5],g=o[6];(m>h||f>p||_>c||v>u||w>N||A>S||y>g)&&t[M]++}return t}function ee(e,a){for(var s=e.length,r=a.length,t=[new Array(r),new Array(r),new Array(r),new Array(r),new Array(r),new Array(r),new Array(r)],n=0;n<r;n++){var l=a[n];t[0][n]=l[0],t[1][n]=l[1],t[2][n]=l[2],t[3][n]=l[3],t[4][n]=l[4],t[5][n]=l[5],t[6][n]=l[6]}var i=new Array(r);for(let h=0;h<r;h++)i[h]=0;for(var m=0;m<s;m++){var f=e[m],_=f[0],v=f[1],w=f[2],A=f[3],y=f[4],M=f[5],o=f[6];for(let h=0;h<r;h++)(_>t[0][h]||v>t[1][h]||w>t[2][h]||A>t[3][h]||y>t[4][h]||M>t[5][h]||o>t[6][h])&&i[h]++}return i}function te(e,a,s,r=null,t=null){let n=0,l=0;for(const[i,m]of a.entries())for(const[f,_]of m.entries())i==0&&(n+=e[1][f]*_),i==1&&(l+=e[1][f]*_);for(const[i,m]of s.entries())for(const[f,_]of m.entries())i==0&&(n+=e[0][f]*_),i==1&&(l+=e[0][f]*_);if(Array.isArray(t))for(const[i,m]of t.entries())for(const[f,_]of m.entries())f%2==1&&(i==0&&(n+=r[0][Math.floor((f-1)/2)]*_),i==1&&(l+=r[0][Math.floor((f-1)/2)]*_)),f%2==0&&(i==0&&(n+=r[1][Math.floor(f/2)]*_),i==1&&(l+=r[1][Math.floor(f/2)]*_));return[n,l]}function re(e,a=1,s=0,r=0){let t=[],n=0,l=e,i=0;for(;;){if(r<=0&&(s=0),l=e+Math.min(i,10)*e/10+s,r-=1,n>=1){l=1,t[i]=l;break}t[i]=l,i+=1,n+=46.51/100*l*a}return t}function ne(e){let a=new Array(e.length),s=1;for(const[r,t]of e.entries())a[r]=s*t,s*=1-t;return a}function K(e,a,s,r,t,n,l,i,m,f,_){k(e.length==2),k(e[0].length==e[1].length),k(Math.max(...e[0])<=5),k(Math.min(...e[0])>=0),k(Math.max(...e[1])<=1),k(Math.min(...e[1])>=0);for(const o of e[0])k(Number.isInteger(o));for(const o of e[1])k(Number.isInteger(o));k(Math.max(...t[0])<=5),k(Math.min(...t[0])>=0),k(Math.max(...t[1])<=1),k(Math.min(...t[1])>=0);for(const o of t[0])k(Number.isInteger(o));for(const o of t[1])k(Number.isInteger(o));let v=a;for(const o of v)k(0<o<=1);k(_=="Juice on grace"||_=="No juice");let w=[],A=[];for(let o=0;o<s.length;o++)A[o]=[];for(let o=0;o<e.length;o++){let h=o==0?r:s,p=0;for(let c=0;c<e[o].length;){if(p>=e[o][c]){c++,p=0;continue}let u=v[c],N=re(u),S=ne(N);for(const g of[...Array(s.length).keys()])A[g].push(h[g][c]);w.push(S),p++}}let y=[],M=[];for(let o=0;o<t.length;o++){let h=0;for(let p=0;p<t[o].length;){if(h>=t[o][p]){p++,h=0;continue}let c;_=="Juice on grace"?c=p<=1?l:i:c=p<=1?m:f;let u=Array(c.length).fill(0),N=c.map(g=>g[2]).reduce((g,C)=>g+C,0),S=Array.from({length:9},()=>new Array(u.length).fill(0));for(let g=0;g<u.length;g++){u[g]=c[g][2]/N;for(let C=0;C<7;C++)S[C][g]=n[C][2*p+(1-o)]*c[g][0];for(let C=7;C<9;C++)S[C][g]=n[C][2*p+(1-o)]*c[g][1]*(_=="Juice on grace"?1:0)}M.push(u),y.push(S),h++}}return M.length==0&&(M=[[0]]),y.length==0&&(y=[[[0],[0],[0],[0],[0],[0],[0],[0],[0]]]),[w,A,M,y]}function Q(e,a,s,r,t,n,l,i,m,f,_,v=!1,w=[]){let A=1,y=[];for(;A<=r;){let o=Array(a.length+2).fill(0);for(const h of[...Array(e.length).keys()]){let p=[...Array(e[h].length).keys()].map(u=>u+1),c;v?w.length>0?c=w[h]:c=Math.ceil(A/r*p.length):c=q(p,e[h]);for(const u of[...Array(a.length).keys()])o[u]+=a[u][h]*c}if(Math.max(...i[0])+Math.max(...i[1])>0)for(const h of[...Array(m.length).keys()]){let p=[...Array(m[h].length).keys()].map(u=>u+0),c;v?w.length>0?c=w[h]:c=Math.ceil(A/r*p.length):c=q(p,m[h]);for(const u of[...Array(f[0].length).keys()])o[u]+=f[h][u][c-1]}y.push(o),A++}let M=te(t,n,l,i,_);for(let o=0;o<y.length;o++)y[o][3]+=M[0],y[o][6]+=M[1];return y}function V(e,a,s,r,t,n,l,i,m,f,_,v,w){let A=[],y=[];return A=Q(r,t,n,e,l,i,m,f,_,v,w),y=Q(r,t,n,a,l,i,m,f,_,v,w,!0),[A,y]}function oe(e,a,s,r,t,n,l,i,m,f,_,v,w,A,y,M,o,h=!1){let[p,c,u,N]=K(e,a,s,r,f,_,w,A,y,M,o),[S,g]=V(1e5,0,1e3,p,c,m,e,t,n,f,u,N,v),C=Array(l[0].length).fill(0),L=[];for(let I of[...Array(l[0].length).keys()])L[I]=Array(l.length).fill(0);for(let I of S)for(let[j,F]of l[0].entries()){let E=!1;for(let z of[...Array(l.length).keys()])l[z][j]<I[z]&&(E=!0,L[j][z]++);E||(C[j]+=1/S.length)}let B=[];for(let[I,j]of L.entries()){let F=[...Array(j.length).keys()].sort((T,J)=>j[J]-j[T]),E=[],z=!1;for(let T of F){let J=Z(j[T]/S.length);(J>=.1||!z)&&E.push(i[T]+"("+J.toString()+"%)"),z=!0}Math.max(...j)==0?B.push("None"):B.push(E.join(", "))}return[C,B]}function le(e,a,s,r,t,n,l,i,m,f,_,v,w,A,y,M){let[c,u,N,S]=K(e,a,s,r,m,f,v,w,A,y,M),[g,C]=V(5e4,1e3,1e3,c,u,l,e,t,n,m,N,S,_),L=H(g,C);const B=g.length,I=Math.floor((1-i)*B),j=g[0].length,F=L.map(d=>Math.abs(d-I)),E=F.map((d,x)=>x).sort((d,x)=>F[d]===F[x]?d-x:F[d]-F[x]),z=C[E[0]];let T=[z];for(let d=0;d<c.length;d++){let x=z.slice(),G=z.slice(),U=[Array(c.length).keys()];U.splice(d,1),W(x,u,d),W(G,u,d,-1),T.push(x.slice()),T.push(G.slice());for(let Y=1;Y<c.length-1;Y++){let b=Math.floor(Math.random()*U.length);W(x,u,b),W(G,u,b,-1),U.splice(b,1),T.push(x.slice()),T.push(G.slice())}}let J=H(g,T);const O=J.map(d=>Math.abs(d-I)),X=O.map((d,x)=>x).sort((d,x)=>O[d]===O[x]?d-x:O[d]-O[x]);let R=Array(j+1).fill(0);for(let d=0;d<j;d++)R[d]+=T[X[0]][d];return R[j]=1-J[X[0]]/g.length,R}const P=["Red","Blue","Leaps","Shards","Oreha","Gold","Silver(WIP)"];async function ae(e){const a=e.normal_hone_ticks,s=e.adv_hone_ticks,r=e.budget,n=await(await fetch("/data.json")).text(),{normal_hone_chances:l,normal_hone_weapon_cost:i,normal_hone_armor_cost:m,normal_hone_weapon_unlock:f,normal_hone_armor_unlock:_,adv_hone_cost:v,adv_hone_unlock:w,adv_data_10_20_juice:A,adv_data_30_40_juice:y,adv_data_10_20:M,adv_data_30_40:o}=JSON.parse(n),[h,p]=oe(D(a),l,i,m,f,_,Array.from(P,N=>[r[N]]),P,10,D(s),v,w,A,y,M,o,"No juice",!0);let c=(h[0]*100).toFixed(2),u=p[0];return{chance:c,reason:u}}async function se(e){const a=e.normal_hone_ticks,s=e.adv_hone_ticks,r=e.desired_chance,t=e.adv_hone_strategy,l=await(await fetch("/data.json")).text(),{normal_hone_chances:i,normal_hone_weapon_cost:m,normal_hone_armor_cost:f,normal_hone_weapon_unlock:_,normal_hone_armor_unlock:v,adv_hone_cost:w,adv_hone_unlock:A,adv_data_10_20_juice:y,adv_data_30_40_juice:M,adv_data_10_20:o,adv_data_30_40:h}=JSON.parse(l),p=le(D(a),i,m,f,_,v,10,r/100,D(s),w,A,y,M,o,h,t),c=P.concat(["Red juice","Blue juice","Est. Probability"]);return Object.fromEntries(c.map((u,N)=>[u,p[N]]))}self.addEventListener("message",async e=>{const a=e.data;let s=Date.now();const{id:r,payload:t,which_one:n}=a;k(n=="CostToChance"||n=="ChanceToCost");let l;n=="CostToChance"?l=await ae(t):n=="ChanceToCost"&&(l=await se(t)),l.run_time=((Date.now()-s)/1e3).toFixed(2),self.postMessage({type:"result",id:r,result:l})})})();
